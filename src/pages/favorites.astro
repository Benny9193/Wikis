---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Favorites" description="Your saved favorite articles">
  <div class="favorites-page">
    <div class="page-header">
      <h1>Your Favorites</h1>
      <p>Articles you've bookmarked for quick access.</p>
    </div>

    <div class="favorites-list" id="favorites-list">
      <div class="loading">Loading favorites...</div>
    </div>

    <div class="favorites-empty" id="favorites-empty" style="display: none;">
      <div class="empty-icon">☆</div>
      <h2>No favorites yet</h2>
      <p>Click the favorite button on any article to save it here for quick access.</p>
      <a href="/random" class="cta-btn">Discover Articles</a>
    </div>
  </div>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const listEl = document.getElementById('favorites-list');
    const emptyEl = document.getElementById('favorites-empty');

    if (!listEl || !emptyEl) return;

    // Get favorites from localStorage
    const getFavorites = (): { url: string; title: string }[] => {
      try {
        return JSON.parse(localStorage.getItem('fallout-wiki-favorites') || '[]');
      } catch {
        return [];
      }
    };

    const favorites = getFavorites();

    if (favorites.length === 0) {
      listEl.style.display = 'none';
      emptyEl.style.display = 'block';
      return;
    }

    // Render favorites
    listEl.innerHTML = favorites.map(fav => `
      <a href="${fav.url}" class="favorite-item">
        <span class="favorite-star">★</span>
        <span class="favorite-title">${fav.title}</span>
        <button class="remove-btn" data-url="${fav.url}" title="Remove from favorites">×</button>
      </a>
    `).join('');

    // Handle remove buttons
    listEl.querySelectorAll('.remove-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();

        const url = (btn as HTMLButtonElement).dataset.url;
        const newFavorites = favorites.filter(f => f.url !== url);
        localStorage.setItem('fallout-wiki-favorites', JSON.stringify(newFavorites));

        // Remove from DOM
        const item = btn.closest('.favorite-item');
        item?.remove();

        // Check if empty
        if (newFavorites.length === 0) {
          listEl.style.display = 'none';
          emptyEl.style.display = 'block';
        }
      });
    });
  });
</script>

<style>
  .favorites-page {
    max-width: 800px;
    margin: 0 auto;
  }

  .page-header {
    margin-bottom: var(--spacing-xl);
    text-align: center;
  }

  .page-header p {
    color: var(--color-text-muted);
    font-size: 1.125rem;
  }

  .favorites-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .loading {
    text-align: center;
    padding: var(--spacing-xl);
    color: var(--color-text-muted);
  }

  .favorite-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-darker);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.2s;
  }

  .favorite-item:hover {
    border-color: var(--color-pip-green);
    background: rgba(24, 255, 109, 0.05);
    text-decoration: none;
  }

  .favorite-star {
    color: var(--color-pip-amber);
    font-size: 1.25rem;
  }

  .favorite-title {
    flex: 1;
    color: var(--color-text);
    font-weight: 500;
  }

  .favorite-item:hover .favorite-title {
    color: var(--color-pip-amber);
  }

  .remove-btn {
    background: transparent;
    border: none;
    color: var(--color-text-muted);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0 var(--spacing-sm);
    line-height: 1;
    transition: color 0.2s;
  }

  .remove-btn:hover {
    color: var(--color-nuka-red);
  }

  .favorites-empty {
    text-align: center;
    padding: var(--spacing-xl);
    background: var(--color-bg-darker);
    border: 1px solid var(--color-border);
    border-radius: 8px;
  }

  .empty-icon {
    font-size: 4rem;
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-md);
  }

  .favorites-empty h2 {
    color: var(--color-pip-amber);
    margin-bottom: var(--spacing-sm);
  }

  .favorites-empty p {
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-lg);
  }

  .cta-btn {
    display: inline-block;
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-pip-green);
    color: var(--color-bg-dark);
    border-radius: 4px;
    font-weight: bold;
    text-decoration: none;
    transition: background 0.2s;
  }

  .cta-btn:hover {
    background: var(--color-pip-amber);
    text-decoration: none;
  }
</style>
